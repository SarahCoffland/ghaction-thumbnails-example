name: GitHub action img-resizer
on:
  push:
    branches: [ master ]
jobs:
  build:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v2
        - name: Image Resizer Action 480
          uses: sharadcodes/img-resizer@v1.1
          with:
            image-folder: 'test'
            new-resolution: '480'
            output-folder: "test/img-resizer/480"
        - name: Image Resizer Action 960
          uses: sharadcodes/img-resizer@v1.1
          with:
            image-folder: 'test'
            new-resolution: '960'
            output-folder: "test/img-resizer/960"
        - name: Commit thumbnail folder
          run: |
            echo "Commiting folder ${{env.thumbnails}}"
            git config --local user.name "${{github.actor}}"
            git config --local user.email "${{github.actor}}@users.noreply.github.com"
            git pull
            git add ./${{env.thumbnails}} || exit 0
            git commit -m "[skip ci] Autogenerated missing thumbnails" -a || exit 0
            git push -f -q https://${{secrets.GITHUB_TOKEN}}@github.com/${{github.repository}}
          env:
            CI: true
            thumbnails: 'test/img-resizer'
